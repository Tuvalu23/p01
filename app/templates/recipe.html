{% extends "base.html" %}
{% block title %}{{ recipe.title }} - {{ country_name }} Recipe{% endblock %}

{% block content %}
<div class="mt-8">
    <h1 class="text-3xl font-bold mb-4 text-center">{{ recipe.title }}</h1>
    {% if recipe.image %}
    <div class="flex justify-center mb-6">
        <img src="{{ recipe.image }}" alt="{{ recipe.title }}" class="max-w-md rounded shadow"/>
    </div>
    {% endif %}
    <h2 class="text-2xl font-semibold mb-2">Ingredients</h2>
    <pre class="bg-gray-100 p-4 rounded mb-4 text-black">{{ recipe.ingredients }}</pre>

    <h2 class="text-2xl font-semibold mb-2">Instructions</h2>
    <p class="bg-gray-100 p-4 rounded mb-4 text-black">{{ recipe.instructions }}</p>

    <h2 class="text-2xl font-semibold mb-4">Votes</h2>
    <p class="mb-2">Upvotes: {{ upvotes }} | Downvotes: {{ downvotes }}</p>
    <div class="flex items-center space-x-4">
        <button 
            class="vote-button bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
            data-recipe-id="{{ recipe.id }}" 
            data-country-name="{{ country_name }}" 
            data-action="upvote"
        >
            üëç Upvote
        </button>
        <span id="upvotes-{{ recipe.id }}" class="font-bold text-blue-500">{{ recipe.upvotes }}</span>
    
        <button 
            class="vote-button bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
            data-recipe-id="{{ recipe.id }}" 
            data-country-name="{{ country_name }}" 
            data-action="downvote"
        >
            üëé Downvote
        </button>
        <span id="downvotes-{{ recipe.id }}" class="font-bold text-blue-500">{{ recipe.downvotes }}</span>
    </div>
    

    <a href="{{ url_for('country_recipes_all', country_name=country_name) }}" class="text-blue-500 hover:underline mt-4 inline-block">Back to All Recipes</a><p></p>
    <a href="{{ url_for('country_page', country_name=country_name) }}" class="text-blue-500 hover:underline mt-4 inline-block">Back to {{ country_name }}</a>
</div>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll(".vote-button").forEach(button => {
            button.addEventListener("click", event => {
                event.preventDefault();
    
                const recipeId = button.dataset.recipeId;
                const countryName = button.dataset.countryName;
                const action = button.dataset.action;
    
                fetch(`/country/${countryName}/recipe/${recipeId}/vote`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/x-www-form-urlencoded"
                    },
                    body: new URLSearchParams({ action: action })
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.upvotes !== undefined && data.downvotes !== undefined) {
                        // Update upvotes and downvotes in the UI
                        document.querySelector(`#upvotes-${recipeId}`).innerText = data.upvotes;
                        document.querySelector(`#downvotes-${recipeId}`).innerText = data.downvotes;
                    }
                })
                .catch(error => {
                    console.error("Error:", error);
                });
            });
        });
    });      
    </script>
    
{% endblock %}
